global
    daemon
    log stdout local0 info
    maxconn 4096

defaults
    mode http
    log global
    option httplog
    option dontlognull
    option log-health-checks
    option forwardfor
    option http-server-close
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    errorfile 400 /dev/null
    errorfile 403 /dev/null
    errorfile 408 /dev/null
    errorfile 500 /dev/null
    errorfile 502 /dev/null
    errorfile 503 /dev/null
    errorfile 504 /dev/null

# HAProxy Statistics
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 30s
    stats hide-version

# Elasticsearch Frontend
frontend elasticsearch_frontend
    bind *:9999
    default_backend elasticsearch_backend

# Elasticsearch Backend with Health Checks
backend elasticsearch_backend
    balance roundrobin
    option httpchk GET /_cluster/health
    http-check expect status 200
    
    # Coordinating nodes (primary endpoints for client requests)
    server es-coordinator-01 es-coordinator-01:9200 check inter 30s rise 2 fall 3 weight 100
    server es-coordinator-02 es-coordinator-02:9200 check inter 30s rise 2 fall 3 weight 100
    
    # Master/Data nodes (backup endpoints, lower weight)
    server es-master-01 es-master-01:9200 check inter 30s rise 2 fall 3 weight 50
    server es-master-02 es-master-02:9200 check inter 30s rise 2 fall 3 weight 50
    server es-master-03 es-master-03:9200 check inter 30s rise 2 fall 3 weight 50
    server es-data-01 es-data-01:9200 check inter 30s rise 2 fall 3 weight 50
